import tkinter as tk
from tkinter import filedialog
import os
from moviepy.editor import VideoFileClip
from pydub import AudioSegment
os.system("cls")
def open_file_dialog():
    root = tk.Tk()
    root.withdraw()  # скрыть основное окно tkinter

    file_path = filedialog.askopenfilename()
    return file_path

def compress_mp4(file_path, target_size_mb):
    clip = VideoFileClip(file_path)
    current_size_mb = os.path.getsize(file_path) / (1024 * 1024)

    if current_size_mb > target_size_mb:
        # Вычисляем новую продолжительность, чтобы достичь требуемого размера
        ratio = (target_size_mb * 1024 * 1024) / os.path.getsize(file_path)
        new_duration = clip.duration * (ratio ** 0.5)  # используем квадратный корень для сохранения аудиоканала

        # Сжимаем видео и сохраняем его
        compressed_clip = clip.subclip(0, new_duration)
        compressed_clip.write_videofile("compressed_video.mp4", codec="libx264", audio_codec="aac")

        print(f"Видео сжат до {target_size_mb} MB.")

def compress_mp3(file_path, target_size_mb):
    audio = AudioSegment.from_file(file_path, format="mp3")
    current_size_mb = os.path.getsize(file_path) / (1024 * 1024)

    if current_size_mb > target_size_mb:
        # Вычисляем новую продолжительность, чтобы достичь требуемого размера
        ratio = (target_size_mb * 1024 * 1024) / os.path.getsize(file_path)
        new_duration = int(len(audio) * (ratio ** 0.5))  # используем квадратный корень для сохранения аудиоканала

        # Сжимаем аудио и сохраняем его
        compressed_audio = audio[:new_duration]
        compressed_audio.export("compressed_audio.mp3", format="mp3")

        print(f"Аудио сжато до {target_size_mb} MB.")

# Пример использования:
file_path = open_file_dialog()
if file_path:
    try:
        target_size_mb = float(input("Введите желаемый размер файла в мегабайтах: "))
        file_extension = os.path.splitext(file_path)[1].lower()

        if file_extension == '.mp4':
            compress_mp4(file_path, target_size_mb)
        elif file_extension == '.mp3':
            compress_mp3(file_path, target_size_mb)
        else:
            print("Данный формат файла не поддерживается.")
    except ValueError:
        print("Некорректный ввод. Пожалуйста, введите число.")
